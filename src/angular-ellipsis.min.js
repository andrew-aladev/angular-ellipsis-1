"use strict";angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",function($timeout,$window){function debounce(func,timeout){var timer=null;return function(){var context=this,args=arguments;null!=timer&&clearTimeout(timer),timer=setTimeout(function(){timer=null,func(context,args)},timeout)}}function hasOverflow(node){return node.scrollWidth>node.clientWidth||node.scrollHeight>node.clientHeight}function buildEllipsis(element,node,originalText,separator,symbol){if(null!=originalText){if(""==originalText)return void element.text("");if(element.text(originalText),hasOverflow(node)){for(var words=originalText.split(separator),text="",wordsCount=0,tailWordsCount=words.length;;){var leftTailWordsCount=Math.ceil(tailWordsCount/2),newText=words.slice(0,wordsCount+leftTailWordsCount).join(separator);if(element.text(newText),hasOverflow(node)){if(tailWordsCount=leftTailWordsCount,1==tailWordsCount){element.text(text);break}}else if(text=newText,wordsCount+=leftTailWordsCount,tailWordsCount-=leftTailWordsCount,0==tailWordsCount)break}if(wordsCount!=words.length)for(;;){var newText=text+symbol;element.text(newText);{if(!hasOverflow(node)){text=newText;break}if(0==wordsCount){element.text(text);break}wordsCount--,text=words.slice(0,wordsCount).join(separator)}}}}}var DEFAULT_SEPARATOR=" ",DEFAULT_SYMBOL="...",DEFAULT_DEBOUNCE_TIMEOUT=500;return{restrict:"A",scope:{ngShow:"=",ngBind:"=",ellipsisSeparator:"@",ellipsisSymbol:"@",ellipsisDebounceTimeout:"@"},compile:function(_element,_attributes,_linker){return function(scope,element,attributes){function onResize(){(windowWidth!=$window.innerWidth||windowHeight!=$window.innerHeight||scrollWidth!=node.scrollWidth||clientWidth!=node.clientWidth||scrollHeight!=node.scrollHeight||clientHeight!=node.clientHeight)&&(windowWidth=$window.innerWidth,windowHeight=$window.innerHeight,scrollWidth=node.scrollWidth,clientWidth=node.clientWidth,scrollHeight=node.scrollHeight,clientHeight=node.clientHeight,process())}var node=element[0],process=debounce(function(){buildEllipsis(element,node,scope.ngBind,scope.ellipsisSeparator||DEFAULT_SEPARATOR,scope.ellipsisSymbol||DEFAULT_SYMBOL)},scope.ellipsisDebounceTimeout||DEFAULT_DEBOUNCE_TIMEOUT);scope.$watchGroup(["ngShow","ngBind","ellipsisSeparator","ellipsisSymbol","ellipsisDebounceTimeout",function(){return node.offsetWidth>0&&0!=node.offsetHeight}],process);var windowWidth=null,windowHeight=null,scrollWidth=null,clientWidth=null,scrollHeight=null,clientHeight=null,window=angular.element($window);window.bind("resize",onResize),scope.$on("$destroy",function(){window.unbind("resize",onResize)})}}}});